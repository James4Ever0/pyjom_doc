{
    "summary": "This code creates an eBegging template using defined colors and styles for Alipay and WeChat. It generates QR codes with text overlays, applies masks, determines font color, places text, and saves the final image to output file.",
    "details": [
        {
            "comment": "This code imports necessary libraries, defines variables for image size and colors, and includes a function to convert color codes into paints. It will be used to create an eBegging template by drawing text, QR codes, and potentially adding effects such as blend modes.",
            "location": "\"/media/root/Toshiba XG3/works/pyjom_doc/src/tests/bilibili_video_recommendation_server/ebegging_template.py\":0-34",
            "content": "# this is to make it look better than before\n# maybe.\n# according to the blend mode, that guy seems to be using some special blend mode to hide his qrcode from being detected. so you may want to do the same when you add this to your own picture.\nalipay_link = \"https://qr.alipay.com/tsx10243tdewwaxrvullge8\"\nwechat_link = (\n    \"wxp://f2f0V92qUQI0aBO5PXtWezujxMm-C1KFub6qCi1Obt3cn1KjZqDPqoWKn8ICCcwdt8zU\"\n)\nfrom generate_qr_code import makeAndSaveQrcode\nqrcode_path = \"test_ebegging.png\"\n# now we plan to draw this thing.\n# how big is the canvas? no fill?\nimport pixie\nfont_path = \"./wqy-microhei0.ttf\"\nad_height = 800\nad_width = 700\nnight_mode = True\nstyle_mode = True\noutput_path = \"ebegging_template.png\"\n# white = pixie.Color(1, 1, 1, 1)\n# black = pixie.Color(0, 0, 0, 1)\nbackground_opacity = 1\ndef makeColorAndPaintFromColorCode(color_code: str):\n    assert len(color_code) == 6 + 1 and color_code.startswith(\"#\")\n    color = pixie.parse_color(color_code)\n    paint = pixie.Paint(pixie.SOLID_PAINT)\n    paint.color = color"
        },
        {
            "comment": "The code defines colors and their corresponding paints, then creates a dictionary of style suites for Alipay and WeChat. It selects the Alipay style suite, extracts QR code link and paint, saves the QR code image, resizes it, and sets up an Image object for further processing.",
            "location": "\"/media/root/Toshiba XG3/works/pyjom_doc/src/tests/bilibili_video_recommendation_server/ebegging_template.py\":35-75",
            "content": "    return color, paint\nocean_blue, ocean_blue_paint = makeColorAndPaintFromColorCode(\"#0A3CCF\")\ngrass_green, grass_green_paint = makeColorAndPaintFromColorCode(\"#00A619\")\nwhite, white_paint = makeColorAndPaintFromColorCode(\"#FFFFFF\")\nblack, black_paint = makeColorAndPaintFromColorCode(\"#000000\")\nstyleSuites = {\n    \"alipay\":{\n        'paint':ocean_blue_paint,\n        'qrcode':alipay_link,\n        'text':\"\u652f\u4ed8\u5b9d\u6295\u5582\"\n    },\n    'wechat':{\n        'paint':grass_green_paint,\n        'qrcode':wechat_link,\n        'text':\"\u5fae\u4fe1\u6295\u5582\"\n    }\n}\n# selected_style_suite = styleSuites['wechat']\nselected_style_suite = styleSuites['alipay']\nqrcode_link = selected_style_suite['qrcode']\nmakeAndSaveQrcode(qrcode_link, qrcode_path)\nqrcode_stroke_paint = selected_style_suite['paint']  # for alipay\nqrcode_scan_text = selected_style_suite['text']\nimage = pixie.Image(ad_width, ad_height)\nqrcode = pixie.read_image(qrcode_path)\nqrcode_width = qrcode_height = int(0.9 * ad_width)\nqrcode = qrcode.resize(qrcode_width, qrcode_height)\nqrcode_rounded_corner = int((0.05 / 0.3) * qrcode_width)"
        },
        {
            "comment": "This code creates a QR code and applies it to an ad image with rounded corners. It calculates dimensions for the QR code and ad image, sets fill paint colors based on style and night mode, and fills the image with appropriate color before applying the font for the text. Font size adjustment is done based on QR code width, but may require further validation.",
            "location": "\"/media/root/Toshiba XG3/works/pyjom_doc/src/tests/bilibili_video_recommendation_server/ebegging_template.py\":76-117",
            "content": "qrcode_stroke_path = pixie.Path()\nqrcode_stroke_path.rounded_rect(\n    0, 0, qrcode_width, qrcode_height, *([qrcode_rounded_corner] * 4)\n)\nqrcode_width_margin = int((ad_width - qrcode_width) / 2)\nqrcode_height_margin = int(ad_height - qrcode_height - qrcode_width_margin)\nebegging_mask_path = pixie.Path()\nebegging_mask_path.rounded_rect(\n    0, 0, ad_width, ad_height, *([int(qrcode_rounded_corner*1.2)] * 4)\n)\nif not style_mode:\n    if not night_mode:\n        fill_paint = white_paint\n    else:\n        fill_paint = black_paint\nelse:\n    fill_paint = qrcode_stroke_paint\nimport copy\nfill_paint = copy.deepcopy(fill_paint)\nfill_paint.color = copy.deepcopy(fill_paint.color)\nfill_paint.opacity = background_opacity\nimage.fill_path(\n    ebegging_mask_path, fill_paint\n)\n# fill the ebegging ad with appropriate color first\nfont = pixie.read_font(font_path)\nfont.size = int(\n    qrcode_width * (0.04 / 0.3)\n)  # questionable. we shall check the font size.\nif not style_mode:\n    if night_mode:\n        font.paint.color = white\n        # font.paint.color = qrcode_stroke_paint.color"
        },
        {
            "comment": "This code generates a QR code image with text overlay and applies a mask to it. It first determines the font color based on the ad type, then places the text at the specified coordinates. A translation is applied to the QR code path, the stroke width is calculated, and a mask is created using the stroked path. Finally, the QR code image is drawn onto the main image with the transformation applied, and saved to the output file.",
            "location": "\"/media/root/Toshiba XG3/works/pyjom_doc/src/tests/bilibili_video_recommendation_server/ebegging_template.py\":118-156",
            "content": "    else:\n        # font.paint.color = qrcode_stroke_paint.color\n        font.paint.color = black\nelse:\n    font.paint.color = white\ntext_bound_x = ad_width\ntext_bound_y = qrcode_height_margin\nimage.fill_text(\n    font,\n    qrcode_scan_text,\n    bounds=pixie.Vector2(text_bound_x, text_bound_y),\n    h_align=pixie.CENTER_ALIGN,\n    v_align=pixie.MIDDLE_ALIGN,\n)\nqrcode_transform = pixie.translate(\n    qrcode_width_margin,\n    qrcode_height_margin,\n)\nstroke_param = 100 / 3\nstroke_width = int(qrcode_width / stroke_param)\nimage.stroke_path(\n    qrcode_stroke_path,\n    qrcode_stroke_paint,\n    qrcode_transform,\n    stroke_width=stroke_width,\n)\nqrcode_mask = pixie.Mask(qrcode_width, qrcode_width)\nqrcode_mask.fill_path(qrcode_stroke_path)\nqrcode.mask_draw(qrcode_mask)\nimage.draw(qrcode, qrcode_transform)\nimage.write_file(output_path)"
        }
    ]
}